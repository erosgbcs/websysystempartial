<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bookkeeping System (Python + CSV Simulation)</title>
  <style>
    body {
      background: #111;
      color: #0f0;
      font-family: Consolas, monospace;
      padding: 20px;
    }
    textarea, pre {
      width: 100%;
      background: #000;
      color: #0f0;
      border: 1px solid #333;
      padding: 10px;
      margin-top: 10px;
    }
    button {
      background: #0f0;
      color: #000;
      border: none;
      padding: 10px 20px;
      margin-top: 10px;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>üíª Bookkeeping System ‚Äî Python + Browser CSV</h1>
  <p>This runs your bookkeeping code using <b>Pyodide</b>. Data is saved locally like a CSV file.</p>

  <textarea id="output" rows="20" readonly></textarea><br>
  <button onclick="runCode()">‚ñ∂Ô∏è Run Bookkeeping</button>

  <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
  <script>
    async function runCode() {
      const output = document.getElementById("output");
      output.value = "Loading Python...\n";
      const pyodide = await loadPyodide();
      output.value += "Python loaded!\n";

      // Python code
      const code = `
import js
import csv
from datetime import datetime
import io

# Simulated CSV file stored in browser localStorage
def load_csv():
    data = js.localStorage.getItem("bookkeeping_csv")
    if not data:
        return []
    reader = csv.DictReader(io.StringIO(data))
    return list(reader)

def save_csv(rows):
    f = io.StringIO()
    writer = csv.DictWriter(f, fieldnames=['Date','Description','Type','Category','Amount'])
    writer.writeheader()
    writer.writerows(rows)
    js.localStorage.setItem("bookkeeping_csv", f.getvalue())

def show_data(rows):
    if not rows:
        print("No transactions yet. Add one first!")
        return
    print("\\n# Date       Description       Type     Category       Amount")
    print("-" * 70)
    for r in rows:
        print(f"{r['Date']:10} {r['Description']:15} {r['Type']:8} {r['Category']:10} {r['Amount']:>8}")

rows = load_csv()
print("üìò Bookkeeping system ready.")
show_data(rows)

print("\\nAdding new income...")
today = datetime.today().strftime('%Y-%m-%d')
rows.append({
    'Date': today,
    'Description': 'Online Sale',
    'Type': 'Income',
    'Category': 'Sales',
    'Amount': '5000'
})
save_csv(rows)
print("‚úÖ New income saved locally!")

print("\\nReloaded transactions:")
show_data(load_csv())
`;
      try {
        const result = await pyodide.runPythonAsync(code);
        output.value += "\\nRun complete! Reload page to see saved data.";
      } catch (e) {
        output.value += "\\n‚ùå Error: " + e;
      }
    }
  </script>
</body>
</html>
